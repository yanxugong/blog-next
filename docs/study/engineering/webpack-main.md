# ã€Œwebpack æ ¸å¿ƒç‰¹æ€§ã€å·¥ä½œåŸç†

## å‰è¨€

åœ¨æ¬ç –è¿‡ç¨‹ä¸­ï¼Œwebpack å¸¸è§çš„é—®é¢˜æˆ‘ä»¬éƒ½èƒ½è§£å†³ã€‚

ä½†å½“åœ¨å®æˆ˜ä¸­é‡åˆ°å¾ˆç‰¹æ®Šçš„éœ€æ±‚æˆ–è€…ç¤¾åŒºã€webpack issues ä¸­æ‰¾ä¸åˆ°è§£å†³æ–¹æ¡ˆæ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦è‡ªå·±æ‰‹å†™ [loader](https://juejin.cn/post/6916315177411411981) ã€æ‰‹å†™ [plugin](https://juejin.cn/post/6922965817638256653) å’Œäº†è§£ webpack çš„å·¥ä½œåŸç†äº†ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fde1c3fbc839435db238aec796abad70~tplv-k3u1fbpfcp-watermark.image)

æœ¬æ–‡ä»å‡ ä¸ªé¢è¯•ç®¡å¸¸é—®çš„é—®é¢˜ï¼Œä»‹ç» webpack çš„å·¥ä½œåŸç†ã€‚è®©æˆ‘ä»¬å¯¹ webpack æœ‰æ›´æ·±çš„è®¤è¯†ï¼Œä½¿ç”¨å®ƒæ—¶æ›´åŠ å¾—å¿ƒåº”æ‰‹ã€‚

## webpack çš„æ„å»ºæµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9daa12cc07e04be18bfca8e4d5227374~tplv-k3u1fbpfcp-watermark.image)

1. **åˆå§‹åŒ–å‚æ•°**ï¼šè§£æ webpack é…ç½®å‚æ•°ï¼Œåˆå¹¶ shell ä¼ å…¥å’Œ webpack.config.js æ–‡ä»¶é…ç½®çš„å‚æ•°ï¼Œå½¢æˆæœ€åçš„é…ç½®ç»“æœï¼›

2. **å¼€å§‹ç¼–è¯‘**ï¼šä¸Šä¸€æ­¥å¾—åˆ°çš„å‚æ•°åˆå§‹åŒ– compiler å¯¹è±¡ï¼Œæ³¨å†Œæ‰€æœ‰é…ç½®çš„æ’ä»¶ï¼Œæ’ä»¶ç›‘å¬ webpack æ„å»ºç”Ÿå‘½å‘¨æœŸçš„äº‹ä»¶èŠ‚ç‚¹ï¼Œåšå‡ºç›¸åº”çš„ååº”ï¼Œæ‰§è¡Œå¯¹è±¡çš„ run æ–¹æ³•å¼€å§‹æ‰§è¡Œç¼–è¯‘ï¼›

3. **ç¡®å®šå…¥å£**ï¼šä»é…ç½®çš„ entry å…¥å£ï¼Œå¼€å§‹è§£ææ–‡ä»¶æ„å»º AST è¯­æ³•æ ‘ï¼Œæ‰¾å‡ºä¾èµ–ï¼Œé€’å½’ä¸‹å»ï¼›

4. **ç¼–è¯‘æ¨¡å—**ï¼šé€’å½’ä¸­æ ¹æ®æ–‡ä»¶ç±»å‹å’Œ loader é…ç½®ï¼Œè°ƒç”¨æ‰€æœ‰é…ç½®çš„ loader å¯¹æ–‡ä»¶è¿›è¡Œè½¬æ¢ï¼Œå†æ‰¾å‡ºè¯¥æ¨¡å—ä¾èµ–çš„æ¨¡å—ï¼Œå†é€’å½’æœ¬æ­¥éª¤ç›´åˆ°æ‰€æœ‰å…¥å£ä¾èµ–çš„æ–‡ä»¶éƒ½ç»è¿‡äº†æœ¬æ­¥éª¤çš„å¤„ç†ï¼›

5. **å®Œæˆæ¨¡å—ç¼–è¯‘å¹¶è¾“å‡º**ï¼šé€’å½’å®Œäº‹åï¼Œå¾—åˆ°æ¯ä¸ªæ–‡ä»¶ç»“æœï¼ŒåŒ…å«æ¯ä¸ªæ¨¡å—ä»¥åŠä»–ä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ ¹æ® entry æˆ–åˆ†åŒ…é…ç½®ç”Ÿæˆä»£ç å— chunk ï¼›

6. **è¾“å‡ºå®Œæˆ**ï¼šè¾“å‡ºæ‰€æœ‰çš„ chunk åˆ°æ–‡ä»¶ç³»ç»Ÿï¼›

> æ¸©é¦¨æç¤ºï¼šåœ¨æ„å»ºç”Ÿå‘½å‘¨æœŸä¸­æœ‰ä¸€ç³»åˆ—æ’ä»¶åœ¨åšåˆé€‚çš„æ—¶æœºåšåˆé€‚äº‹æƒ…ï¼Œæ¯”å¦‚ UglifyPlugin ä¼šåœ¨ loader è½¬æ¢é€’å½’å®Œå¯¹ç»“æœä½¿ç”¨ UglifyJs å‹ç¼©è¦†ç›–ä¹‹å‰çš„ç»“æœã€‚

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/df6e7d41fbc6407baac96d98214ba592~tplv-k3u1fbpfcp-watermark.image)

## ä»€ä¹ˆæ˜¯ webpack äº‹ä»¶æµï¼Ÿ

webpack å°±åƒä¸€æ¡ç”Ÿäº§çº¿ï¼Œè¦ç»è¿‡ä¸€ç³»åˆ—å¤„ç†æµç¨‹åæ‰èƒ½å°†æºæ–‡ä»¶è½¬æ¢æˆè¾“å‡ºç»“æœã€‚ è¿™æ¡ç”Ÿäº§çº¿ä¸Šçš„æ¯ä¸ªå¤„ç†æµç¨‹çš„èŒè´£éƒ½æ˜¯å•ä¸€çš„ï¼Œå¤šä¸ªæµç¨‹ä¹‹é—´æœ‰å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œåªæœ‰å®Œæˆå½“å‰å¤„ç†åæ‰èƒ½äº¤ç»™ä¸‹ä¸€ä¸ªæµç¨‹å»å¤„ç†ã€‚ æ’ä»¶å°±åƒæ˜¯ä¸€ä¸ªæ’å…¥åˆ°ç”Ÿäº§çº¿ä¸­çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œåœ¨ç‰¹å®šçš„æ—¶æœºå¯¹ç”Ÿäº§çº¿ä¸Šçš„èµ„æºåšå¤„ç†ã€‚

webpack é€šè¿‡ tapable æ¥ç»„ç»‡è¿™æ¡å¤æ‚çš„ç”Ÿäº§çº¿ã€‚ webpack åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¼šå¹¿æ’­äº‹ä»¶ï¼Œæ’ä»¶åªéœ€è¦ç›‘å¬å®ƒæ‰€å…³å¿ƒçš„äº‹ä»¶ï¼Œå°±èƒ½åŠ å…¥åˆ°è¿™æ¡ç”Ÿäº§çº¿ä¸­ï¼Œå»æ”¹å˜ç”Ÿäº§çº¿çš„è¿ä½œã€‚ webpack çš„äº‹ä»¶æµæœºåˆ¶ä¿è¯äº†æ’ä»¶çš„æœ‰åºæ€§ï¼Œä½¿å¾—æ•´ä¸ªç³»ç»Ÿæ‰©å±•æ€§å¾ˆå¥½ã€‚

--å´æµ©éºŸã€Šæ·±å…¥æµ…å‡º webpackã€‹

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9f964a40be7f47d3bb86f9632e78ec66~tplv-k3u1fbpfcp-watermark.image)

## èƒ½è¯¦ç»†æè¿°ä¸€ä¸‹ webpack çš„è¿è¡Œæµç¨‹å—ï¼Ÿ

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/573cf055e1f54649b7e4bd0066880b3b~tplv-k3u1fbpfcp-watermark.image)

1. è°ƒç”¨ `webpack` å‡½æ•°æ¥æ”¶ `config` é…ç½®ä¿¡æ¯ï¼Œå¹¶åˆå§‹åŒ– `compiler`ï¼Œåœ¨æ­¤æœŸé—´ä¼š `apply` æ‰€æœ‰ `webpack` å†…ç½®çš„æ’ä»¶;
2. è°ƒç”¨ `compiler.run` è¿›å…¥æ¨¡å—ç¼–è¯‘é˜¶æ®µï¼›
3. æ¯ä¸€æ¬¡æ–°çš„ç¼–è¯‘éƒ½ä¼šå®ä¾‹åŒ–ä¸€ä¸ª `compilation` å¯¹è±¡ï¼Œè®°å½•æœ¬æ¬¡ç¼–è¯‘çš„åŸºæœ¬ä¿¡æ¯ï¼›
4. è¿›å…¥ `make` é˜¶æ®µï¼Œå³è§¦å‘ `compilation.hooks.make` é’©å­ï¼Œä» `entry` ä¸ºå…¥å£ï¼ša. è°ƒç”¨åˆé€‚çš„ `loader` å¯¹æ¨¡å—æºç é¢„å¤„ç†ï¼Œè½¬æ¢ä¸ºæ ‡å‡†çš„ JS æ¨¡å—ï¼›b. è°ƒç”¨ç¬¬ä¸‰æ–¹æ’ä»¶ `acorn` å¯¹æ ‡å‡† JS æ¨¡å—è¿›è¡Œåˆ†æï¼Œæ”¶é›†æ¨¡å—ä¾èµ–é¡¹ã€‚åŒæ—¶ä¹Ÿä¼šç»§ç»­é€’å½’æ¯ä¸ªä¾èµ–é¡¹ï¼Œæ”¶é›†ä¾èµ–é¡¹çš„ä¾èµ–é¡¹ä¿¡æ¯ï¼Œä¸æ–­é€’å½’ä¸‹å»ï¼›æœ€ç»ˆä¼šå¾—åˆ°ä¸€é¢—ä¾èµ–æ ‘ï¼›
5. æœ€åè°ƒç”¨ `compilation.seal` render æ¨¡å—ï¼Œæ•´åˆå„ä¸ªä¾èµ–é¡¹ï¼Œæœ€åè¾“å‡ºä¸€ä¸ªæˆ–å¤šä¸ª `chunk`ï¼›

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f1a0f79f9e864fa8b33bdb1fa7c3765e~tplv-k3u1fbpfcp-watermark.image)

## ä½ çŸ¥é“å¦‚ä½•ä¼˜åŒ– webpack çš„æ„å»ºæ€§èƒ½å—ï¼Ÿ

### é€šç”¨

é€‚ç”¨äº `development` æˆ– `production`

#### ç‰ˆæœ¬

ä½¿ç”¨æœ€æ–°ç‰ˆ webpack å’Œ nodejs

#### ç¼©å° loaders ä½œç”¨èŒƒå›´

ä½¿ç”¨ `include` å­—æ®µä»…å°† loader æ¨¡å—åº”ç”¨åœ¨å®é™…éœ€è¦ç”¨å…¶è½¬æ¢çš„ä½ç½®ä¸­ï¼š

```js
{
  test: /\.js$/,
  include: path.resolve(__dirname, "src"),
  loader: "babel-loader"
}
```

#### è§£æ

- å°½é‡å‡å°‘ `resolve.modules`, `resolve.extensions`, `resolve.mainFiles`, `resolve.descriptionFiles` ä¸­ç±»ç›®çš„æ•°é‡ï¼Œå› ä¸ºä»–ä»¬ä¼šå¢åŠ æ–‡ä»¶ç³»ç»Ÿè°ƒç”¨çš„æ¬¡æ•°ã€‚
- å¦‚æœä½ ä¸ä½¿ç”¨ symlinks ï¼Œå¯ä»¥è®¾ç½® `resolve.symlinks: false` (ä¾‹å¦‚ `npm link` æˆ–è€… `yarn link`).
- å¦‚æœä½ ä½¿ç”¨è‡ªå®šä¹‰è§£æ plugins ï¼Œå¹¶ä¸”æ²¡æœ‰æŒ‡å®š context ä¿¡æ¯ï¼Œå¯ä»¥è®¾ç½® `resolve.cacheWithContext: false` ã€‚

#### Dlls

ä½¿ç”¨ DllPlugin å°†ä¸é¢‘ç¹æ›´æ–°çš„ä»£ç å•ç‹¬ç¼–è¯‘ã€‚

#### å‡å°‘ç¼–è¯‘çš„æ•´ä½“å¤§å°

- ä½¿ç”¨ æ›´å°‘/æ›´å° çš„åº“ã€‚
- åœ¨å¤šé¡µé¢åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ `CommonsChunksPlugin`ã€‚
- åœ¨å¤šé¡µé¢åº”ç”¨ç¨‹åºä¸­ä»¥ `async` æ¨¡å¼ä½¿ç”¨ `CommonsChunksPlugin` ã€‚
- ç§»é™¤ä¸ä½¿ç”¨çš„ä»£ç ã€‚
- åªç¼–è¯‘ä½ å½“å‰æ­£åœ¨å¼€å‘éƒ¨åˆ†çš„ä»£ç ã€‚

### å¼€å‘ç¯å¢ƒ

é€‚ç”¨äº `development`

#### åœ¨å†…å­˜ä¸­ç¼–è¯‘

ä»¥ä¸‹å‡ ä¸ªå®ç”¨å·¥å…·é€šè¿‡åœ¨å†…å­˜ä¸­è¿›è¡Œä»£ç çš„ç¼–è¯‘å’Œèµ„æºçš„æä¾›ï¼Œä½†å¹¶ä¸å†™å…¥ç£ç›˜æ¥æé«˜æ€§èƒ½:

- `webpack-dev-server`
- `webpack-hot-middleware`
- `webpack-dev-middleware`

#### æ’é™¤ç”Ÿäº§ç¯å¢ƒä¸‹æ‰ç”¨åˆ°çš„å·¥å…·

æŸäº›å®ç”¨å·¥å…·ï¼Œ plugins å’Œ loaders éƒ½åªèƒ½åœ¨æ„å»ºç”Ÿäº§ç¯å¢ƒæ—¶æ‰æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œåœ¨å¼€å‘æ—¶ä½¿ç”¨ `UglifyJsPlugin` æ¥å‹ç¼©å’Œä¿®æ”¹ä»£ç æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ä»¥ä¸‹è¿™äº›å·¥å…·åœ¨å¼€å‘ä¸­é€šå¸¸è¢«æ’é™¤åœ¨å¤–:

- `UglifyJsPlugin`
- `ExtractTextPlugin`
- `[hash]/[chunkhash]`
- `AggressiveSplittingPlugin`
- `AggressiveMergingPlugin`
- `ModuleConcatenationPlugin`

### ç”Ÿäº§ç¯å¢ƒ

é€‚ç”¨äº `production`

#### å¹¶è¡Œæ„å»º

å½“è¿›è¡Œå¤šä¸ªç¼–è¯‘æ—¶ï¼Œä»¥ä¸‹å·¥å…·å¯ä»¥å¸®åŠ©åˆ°ä½ :

- `parallel-webpack`: å®ƒå…è®¸ç¼–è¯‘å·¥ä½œåœ¨ worker æ± ä¸­è¿›è¡Œã€‚
- `cache-loader`: ç¼“å­˜å¯ä»¥åœ¨å¤šä¸ªç¼–è¯‘æ—¶ä¹‹é—´å…±äº«ã€‚

## ç³»åˆ—æ–‡ç« 

- [ã€Œwebpack æ ¸å¿ƒç‰¹æ€§ã€loader](https://juejin.cn/post/6916315177411411981)
- [ã€Œwebpack æ ¸å¿ƒç‰¹æ€§ã€æ’ä»¶(plugin)](https://juejin.cn/post/6922965817638256653)
- ã€Œwebpack æ ¸å¿ƒç‰¹æ€§ã€å·¥ä½œåŸç†
- [ã€Œwebpack æ ¸å¿ƒç‰¹æ€§ã€æ¨¡å—çƒ­æ›¿æ¢(HMR)](https://juejin.cn/post/6870258201384714253)

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bcace55dbd7a4df5a428e938abfcfe8f~tplv-k3u1fbpfcp-watermark.image)

## æ„Ÿè°¢

å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ© ğŸ˜˜ï¼Œå°±ç‚¹ä¸ª[Star ğŸ‘](https://github.com/yanxugong/blog) æ”¯æŒä¸‹å§ï¼æ„Ÿè°¢é˜…è¯»ã€‚

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a10ab9f539ae4a18a1262c6d273fa15f~tplv-k3u1fbpfcp-watermark.image)
